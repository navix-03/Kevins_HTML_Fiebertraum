<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
    <title>Stadtbäume Lahr</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/gokertanrisever/leaflet-ruler@master/src/leaflet-ruler.css">  
    <script src="https://cdn.jsdelivr.net/gh/gokertanrisever/leaflet-ruler@master/src/leaflet-ruler.js"></script>

    <style>
        html, body, #mapid { 
            width: 100%; 
            height: 100%; 
            padding: 0; 
            margin: 0; 
        }
    </style>    
</head>
<body>

    <div id="mapid"></div>

    <script>
        // 1. Karte initialisieren
        var mymap = L.map('mapid').setView([48.34, 7.86], 14);

       // 2. Basemaps definieren
        var osm = L.tileLayer('https://{s}.tile.openstreetmap.de/tiles/osmde/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        });

        var satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EBP, and the GIS User Community'
        });

        // OSM als Standard-Hintergrund hinzufügen
        osm.addTo(mymap);

        // 3. Styling & Popups

// Diese Funktion gibt die Farbe passend zur Klasse zurück
function getColor(d) {
    switch (d) {
        case 'pot. Bäume':
            return '#00441b'; // Sehr dunkles Grün
        case 'pot. Hecken und Büsche':
            return '#238b45'; // Mittleres Grün
        case 'pot. Veg':
            return '#a1d99b'; // Hellgrün
        default:
            return '#bdbdbd'; // Grau, falls ein Name nicht passt
    }
}

function styleFunction(feature) {
    return { 
        fillColor: getColor(feature.properties.Class_name), 
        weight: 1,           // Etwas dünnere Linie für bessere Optik
        opacity: 1, 
        color: 'white',      // Weißer Rand hilft bei der Abgrenzung auf Satellitenbildern
        fillOpacity: 0.8     // Etwas kräftiger, damit man die Farben gut erkennt
    };
}

function popUpFunction(feature, layer) {
    if (feature.properties && feature.properties.Class_name) {
        layer.bindPopup("<b>Klassifikation:</b> " + feature.properties.Class_name);
    }
}

        // 4. Popup-Funktion
        function popUpFunction(feature, layer) {
            if (feature.properties && feature.properties.Class_name) {
                layer.bindPopup("<b>Klassifikation:</b> " + feature.properties.Class_name);
            }
        }

        // 5. Daten laden (Greift auf Baeume.geojson zu)
        fetch('Baeume.geojson')
            .then(response => {
                if (!response.ok) {
                    throw new Error("Datei 'Baeume.geojson' wurde nicht gefunden.");
                }
                return response.json();
            })
            .then(data => {
                var overlay_baeume = L.geoJSON(data, {
                    style: styleFunction,
                    onEachFeature: popUpFunction
                }).addTo(mymap);

                // Zoomt automatisch so, dass alle Bäume sichtbar sind
                mymap.fitBounds(overlay_baeume.getBounds());

                // --- LAYER-STEUERUNG ---
                // Hintergrundkarten (Radio-Buttons: nur eine wählbar)
                var baseMaps = {
                    "OpenStreetMap": osm,
                    "Satellitenbild": satellite
                };

                // Overlays (Checkboxes: an/ausschaltbar)
                var overlays = {
                    "Stadtbäume": overlay_baeume
                };

                // Steuerung zur Karte hinzufügen
                L.control.layers(baseMaps, overlays, {collapsed: false}).addTo(mymap);
            })
            .catch(err => {
                console.error("Ladefehler:", err);
                alert("Fehler beim Laden der GeoJSON: " + err.message);
            });

        // 6. Extras
        L.control.scale({metric: true, imperial: false}).addTo(mymap);
        L.control.ruler().addTo(mymap);

// 7. Legende (unten rechts - bleibt immer an)
        var legend = L.control({position: 'bottomright'});

        legend.onAdd = function (map) {
            var div = L.DomUtil.create('div', 'info legend'),
                categories = ['pot. Bäume', 'pot. Hecken und Büsche', 'pot. Veg'],
                labels = ['Baum', 'Busch/Hecke', 'Wiese'];

            div.innerHTML = '<strong>Legende</strong><br>';

            for (var i = 0; i < categories.length; i++) {
                div.innerHTML +=
                    '<i style="background:' + getColor(categories[i]) + '"></i> ' +
                    labels[i] + '<br>';
            }
            return div;
        };
        legend.addTo(mymap);
    </script>
</body>
</html>