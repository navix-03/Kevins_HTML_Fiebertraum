<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
    <title>Stadtbäume in Lahr</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
      integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
      crossorigin=""/>
    
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
      integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
      crossorigin=""></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/gokertanrisever/leaflet-ruler@master/src/leaflet-ruler.css" 
      integrity="sha384-P9DABSdtEY/XDbEInD3q+PlL+BjqPCXGcF8EkhtKSfSTr/dS5PBKa9+/PMkW2xsY" crossorigin="anonymous">  
    <script src="https://cdn.jsdelivr.net/gh/gokertanrisever/leaflet-ruler@master/src/leaflet-ruler.js"
      integrity="sha384-N2S8y7hRzXUPiepaSiUvBH1ZZ7Tc/ZfchhbPdvOE5v3aBBCIepq9l+dBJPFdo1ZJ" crossorigin="anonymous"></script>

    <style>
        html, body { width: 100%; height: 100%; padding: 0; margin: 0; }
        #mapid { width: 100%; height: 100%; }
    </style>    
</head>
<body>

    <div id="mapid"></div>

    <script>
        // 1. Karte initialisieren
        var mymap = L.map('mapid').setView([48.34, 7.86], 13);

        // 2. Basemaps definieren
        var osm_basemap = L.tileLayer('https://{s}.tile.openstreetmap.de/tiles/osmde/{z}/{x}/{y}.png', {
            attribution: '<a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(mymap);

        var otm_basemap = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
            attribution: '<a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a>'
        });

        var osmint_basemap = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        });

        var basemaps = {
            "Open Street Map DE": osm_basemap,
            "Open Topo Map": otm_basemap,
            "Open Street Map INT": osmint_basemap
        };

        // 3. Layer-Control (Legende) vorbereiten (zunächst nur Basemaps)
        var legend = L.control.layers(basemaps, null, {collapsed: false}).addTo(mymap);

        // 4. Styling & Popup Funktionen
        function styleFunction(feature) {
            return {
                fillColor: "#ff7800",
                weight: 2,
                opacity: 1,
                color: 'white',
                fillOpacity: 0.7
            };
        }

        function popUpFunction(feature, layer) {
            if (feature.properties && feature.properties.Class_name) {
                var popupContent = "<b>Klassifikation: </b>" + feature.properties.Class_name;
                layer.bindPopup(popupContent);
            }
        }

        // 5. GeoJSON mit FETCH laden
        // Pfad: Geht davon aus, dass die Datei im selben Ordner wie das HTML liegt
        fetch('Baeume_Lahr.geojson')
            .then(function(response) {
                if (!response.ok) {
                    throw new Error("HTTP Fehler, Status: " + response.status);
                }
                return response.json();
            })
            .then(function(data) {
                // GeoJSON Layer erstellen
                var overlay_baeume = L.geoJSON(data, {
                    style: styleFunction,
                    onEachFeature: popUpFunction
                }).addTo(mymap);

                // Layer zur Legende hinzufügen
                legend.addOverlay(overlay_baeume, "Stadtbäume");

                // Optional: Karte automatisch auf die Polygone zoomen
                mymap.fitBounds(overlay_baeume.getBounds());
            })
            .catch(function(error) {
                console.error("Fehler beim Laden der GeoJSON-Daten:", error);
            });

        // 6. Weitere Controls (Maßstab, Lineal)
        L.control.scale({maxWidth: 150, metric: true, imperial: false}).addTo(mymap);
        L.control.ruler().addTo(mymap);

    </script>
</body>
</html>